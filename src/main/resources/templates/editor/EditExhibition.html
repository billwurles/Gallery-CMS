<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="|Editor Home - ${name}|"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" th:href="@{/css/style.css}">

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <!-- jQuery UI -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.14.1/jquery-ui.min.js"></script>

    <!-- jQuery UI CSS for styling -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.14.1/themes/base/jquery-ui.min.css">

    <!-- jQuery UI Timepicker Addon -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-timepicker-addon/1.6.3/jquery-ui-timepicker-addon.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-timepicker-addon/1.6.3/jquery-ui-timepicker-addon.min.css">


    <!-- Quill Rich Text Editor -->
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Initialize Quill editor
            var quill = new Quill('#richTextEditor', {
                theme: 'snow',
                modules: {
                    toolbar: [
                        [{ header: [1, 2, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ list: 'ordered' }, { list: 'bullet' }],
                        ['link', 'image'],
                        ['clean']
                    ]
                }
            });

            // Populate Quill editor with existing content
            var existingContent = document.querySelector("textarea[name='content']").value;
            if (existingContent) {
                quill.root.innerHTML = existingContent;
            }

        // Date and Time Picker for the date field
        $("#date").datetimepicker({
            dateFormat: "yy-mm-dd",
            timeFormat: "HH:mm", // 24-hour format without seconds
            controlType: 'select',
            oneLine: true
            });

            // Handle form submission to send JSON
            document.querySelector("form").addEventListener("submit", function (event) {
                event.preventDefault(); // Prevent the default form submission

                // Gather form data
                var exhibition = {
                    id: document.getElementById("id").value,
                    title: document.getElementById("title").value,
                    date: document.getElementById("date").value,
                    content: quill.root.innerHTML
                };

                // Send data as JSON via AJAX
                fetch(this.action, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(exhibition)
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Failed to save exhibition');
                    }
                })
                .then(data => {
                    alert("Exhibition saved successfully!");
                    console.log(data); // Log the server's response
                })
                .catch(error => {
                    alert("An error occurred: " + error.message);
                });
            });
        });
    </script>
</head>
<body>
<nav
        th:replace="~{editor/fragments/navigation :: navbar(menuItems=${menuItems}, currentPage='exhibitions', siteName='Exhibition Editor')}">
</nav>

<div class="content">
    <h1 th:text="|${name}|"></h1>
    <div th:if="${message}" style="color: green;">
        <p th:text="${message}"></p>
    </div>

    <h1>Edit Exhibition:</h1>
    <form th:action="${newExhibition} ? @{/exhibition/save} : @{/exhibitions/{id}/save(id=${exhibition.id})}"
          th:object="${exhibition}"
          method="post">
        <!-- Exhibtion id - not editable -->
        <input id="id" type="hidden" th:value="*{id}">

        <!-- Exhibition title -->
        <label for="title">Title:</label>
        <input id="title" type="text" th:field="*{title}" placeholder="Enter the title" required />
        <br>

        <!-- Exhibition date -->
        <label for="date">Date & Time:</label>
        <input id="date" type="text" th:field="*{date}" placeholder="yyyy-MM-dd HH:mm" required />
        <br>

        <!-- Exhibition content -->
        <label for="richTextEditor">Content:</label>
        <div id="richTextEditor"></div>
        <textarea name="content" th:field="*{content}" style="display:none;"></textarea>
        <br>

        <!-- Submit Button -->
        <button type="submit">Save</button>
    </form>
</div>
</body>
</html>
