<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="|Editor Home - ${name}|"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" th:href="@{/css/style.css}">

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <!-- jQuery UI -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.14.1/jquery-ui.min.js"></script>

    <!-- jQuery UI CSS for styling -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.14.1/themes/base/jquery-ui.min.css">
</head>
<body>
<nav class="navbar">
    <div class="navbar-container container">
        <input type="checkbox" name="" id=""/>
        <div class="hamburger-lines">
            <span class="line line1"></span>
            <span class="line line2"></span>
            <span class="line line3"></span>
        </div>
        <ul class="menu-items">
            <li th:each="item : ${menuItems}" class="links">
                <a href="#" th:href="@{${item.url}}"
                   th:text="${item.name}"
                   th:classappend="${item.url == '/${page}' ? 'active' : ''}">
                </a>
            </li>
        </ul>
        <h1 class="logo">
            <a href="/">AHC Web Editor</a>
        </h1>
    </div>
</nav>

<div class="content">
    <h1 th:text="|${name}|"></h1>
    <div th:if="${message}" th:style="'color: ' + (${status} == 'success' ? 'green' : 'red')">
        <p id="messageContainer" th:text="${message}"></p>
    </div>
    <a th:href="@{/page/{url}/gallery/upload(url=${page.url})}">Upload Images to Gallery</a>
    <h1>Gallery Content:</h1>
    <p>Drag paintings to rearrange</p>

    <form id="galleryForm" th:action="@{/page/{url}/gallery/save(url=${page.url})}" method="post">
        <!-- Save Button -->
        <button type="submit">Save Changes</button>

        <!-- Gallery section -->
        <h2 th:if="${hasGallery}">Gallery of Paintings:</h2>
        <div th:if="${hasGallery}">
            <ul id="image-list">
    <li th:each="painting : ${page.gallery.getGalleryInOrder()}" th:data-id="${painting.filename}" th:data-order="${painting.order}">
                    <img th:src="@{/page/{url}/gallery/image/{filename}(url=${page.url},filename=${painting.filename})}"
                         th:alt="${painting.title}" />
                    <div>
                        <label th:for="'title-' + ${painting.order}">Title:</label>
                        <input type="text" th:id="'title-' + ${painting.order}" th:value="${painting.title}" />

                        <label th:for="'dimensions-' + ${painting.order}">Dimensions:</label>
                        <input type="text" th:id="'dimensions-' + ${painting.order}" th:value="${painting.dimensions}" />

                        <label th:for="'medium-' + ${painting.order}">Medium:</label>
                        <input type="text" th:id="'medium-' + ${painting.order}" th:value="${painting.medium}" />

                        <label th:for="'sold-' + ${painting.order}">Sold:</label>
                        <input type="checkbox" th:id="'sold-' + ${painting.order}" th:checked="${painting.sold}" />
                    </div>
                </li>
            </ul>
        </div>
        <!-- Hidden input to store the gallery JSON -->
        <input type="hidden" id="galleryData" name="galleryData" />
    </form>
</div>

<script>
    $(document).ready(function () {
        // Make the image list sortable
        $("#image-list").sortable({
            placeholder: "sortable-placeholder",
            update: function (event, ui) {
                // After the list is reordered, update the order of each painting
                $("#image-list li").each(function (index) {
                    $(this).attr("data-order", index + 1); // Update the order based on the new position
                });
            }
        });

        // Serialize the gallery data before form submission
        $("#galleryForm").on("submit", function (event) {
            event.preventDefault(); // Prevent the default form submission

            const galleryData = {
                gallery: {}
            };

            // Loop through each image and create the gallery data object
            $("#image-list li").each(function () {
                const filename = $(this).data("id");
                const order = $(this).data("order");

                // Gather the painting data from the input fields using painting.order
                galleryData.gallery[filename] = {
                    title: $("#title-" + $(this).find("input[id^='title-']").attr("id").split('-')[1]).val(),
                    filename: filename, // Add the filename
                    dimensions: $("#dimensions-" + $(this).find("input[id^='dimensions-']").attr("id").split('-')[1]).val(),
                    medium: $("#medium-" + $(this).find("input[id^='medium-']").attr("id").split('-')[1]).val(),
                    sold: $("#sold-" + $(this).find("input[id^='sold-']").attr("id").split('-')[1]).prop("checked"),
                    order: order // Get the updated order from the data-order attribute
                };
            });

            // Send the data via AJAX
            $.ajax({
                url: $(this).attr("action"), // Use the form's action URL
                method: "POST",
                contentType: "application/json", // Set Content-Type to JSON
                data: JSON.stringify(galleryData), // Send the gallery data as a JSON string
                success: function (response) {
                // Update the message container based on the status
                const messageContainer = $("#messageContainer");
                const responseMessage = response.message;

                if (response.status === "success") {
                    messageContainer.html("<p style='color: green;'>" + responseMessage + "</p>");
                    } else {
                    messageContainer.html("<p style='color: red;'>" + responseMessage + "</p>");
                }
                },
                error: function (xhr, status, error) {
                $("#messageContainer").html("<p style='color: red;'>An error occurred: " + error + "</p>");
                }
            });
        });
    });
</script>

</body>


<!--<style>-->
<!--*,-->
<!--*::after,-->
<!--*::before {-->
<!--box-sizing: border-box;-->
<!--padding: 0;-->
<!--margin: 0;-->
<!--}-->

<!--.html {-->
<!--font-size: 62.5%;-->
<!--}-->

<!--.navbar input[type="checkbox"],-->
<!--.navbar .hamburger-lines {-->
<!--display: none;-->
<!--}-->

<!--.container {-->
<!--max-width: 1200px;-->
<!--width: 90%;-->
<!--margin: auto;-->
<!--}-->

<!--.navbar {-->
<!--/* box-shadow: 0px 5px 10px 0px #aaa; */-->
<!--/* position: fixed; */-->
<!--width: 100%;-->
<!--background: #fff;-->
<!--color: #000;-->
<!--opacity: 0.85;-->
<!--z-index: 100;-->
<!--}-->

<!--.navbar-container {-->
<!--display: flex;-->
<!--justify-content: space-between;-->
<!--height: 64px;-->
<!--align-items: center;-->
<!--}-->

<!--.menu-items {-->
<!--order: 2;-->
<!--display: flex;-->
<!--flex-wrap: wrap;-->
<!--align-items: center;-->
<!--}-->
<!--.logo {-->
<!--order: 1;-->
<!--font-size: 1.2rem;-->
<!--}-->

<!--.menu-items li {-->
<!--list-style: none;-->
<!--font-size: 1.2rem;-->
<!--margin-left: 1rem;-->
<!--padding-top: 5px;-->
<!--}-->

<!--.navbar a {-->
<!--color: #2c3e50;-->
<!--text-decoration: none;-->
<!--font-weight: 500;-->
<!--font-weight: bold;-->
<!--/* transition: color 0.3s ease-in-out; */-->
<!--}-->

<!--.navbar a.router-link-exact-active {-->
<!--color: #42b983;-->
<!--}-->

<!--.navbar a:hover {-->
<!--color: #117964;-->
<!--}-->

<!--@media (max-width: 778px) {-->
<!--.navbar {-->
<!--opacity: 0.95;-->
<!--}-->

<!--.navbar-container input[type="checkbox"],-->
<!--.navbar-container .hamburger-lines {-->
<!--display: block;-->
<!--}-->

<!--.navbar-container {-->
<!--display: block;-->
<!--position: relative;-->
<!--height: px;-->
<!--}-->

<!--.navbar-container input[type="checkbox"] {-->
<!--position: absolute;-->
<!--display: block;-->
<!--height: 32px;-->
<!--width: 30px;-->
<!--top: 20px;-->
<!--left: 20px;-->
<!--z-index: 5;-->
<!--opacity: 0;-->
<!--cursor: pointer;-->
<!--}-->

<!--.navbar-container .hamburger-lines {-->
<!--display: block;-->
<!--height: 28px;-->
<!--width: 35px;-->
<!--position: absolute;-->
<!--top: 20px;-->
<!--left: 20px;-->
<!--z-index: 2;-->
<!--display: flex;-->
<!--flex-direction: column;-->
<!--justify-content: space-between;-->
<!--}-->

<!--.navbar-container .hamburger-lines .line {-->
<!--display: block;-->
<!--height: 4px;-->
<!--width: 100%;-->
<!--border-radius: 10px;-->
<!--background: #333;-->
<!--}-->

<!--.navbar-container .hamburger-lines .line1 {-->
<!--transform-origin: 0% 0%;-->
<!--transition: transform 0.3s ease-in-out;-->
<!--}-->

<!--.navbar-container .hamburger-lines .line2 {-->
<!--transition: transform 0.2s ease-in-out;-->
<!--}-->

<!--.navbar-container .hamburger-lines .line3 {-->
<!--transform-origin: 0% 100%;-->
<!--transition: transform 0.3s ease-in-out;-->
<!--}-->

<!--.navbar .menu-items {-->
<!--padding-top: 100px;-->
<!--background: #fff;-->
<!--height: 100vh;-->
<!--max-width: 300px;-->
<!--transform: translate(-150%);-->
<!--display: flex;-->
<!--flex-direction: column;-->
<!--margin-left: -40px;-->
<!--padding-left: 40px;-->
<!--transition: transform 0.5s ease-in-out;-->
<!--box-shadow: 5px 0px 10px 0px #aaa;-->
<!--overflow: scroll;-->
<!--}-->

<!--.navbar .menu-items li {-->
<!--margin-bottom: 1.8rem;-->
<!--font-size: 1.1rem;-->
<!--font-weight: 500;-->
<!--}-->

<!--.logo {-->
<!--position: absolute;-->
<!--top: 18px;-->
<!--right: 15px;-->
<!--font-size: 1.5rem;-->
<!--}-->

<!--.navbar-container input[type="checkbox"]:checked ~ .menu-items {-->
<!--transform: translateX(0);-->
<!--}-->

<!--.navbar-container input[type="checkbox"]:checked ~ .hamburger-lines .line1 {-->
<!--transform: rotate(45deg);-->
<!--}-->

<!--.navbar-container input[type="checkbox"]:checked ~ .hamburger-lines .line2 {-->
<!--transform: scaleY(0);-->
<!--}-->

<!--.navbar-container input[type="checkbox"]:checked ~ .hamburger-lines .line3 {-->
<!--transform: rotate(-45deg);-->
<!--}-->
<!--}-->

<!--@media (max-width: 500px) {-->
<!--.navbar-container input[type="checkbox"]:checked ~ .logo {-->
<!--display: none;-->
<!--}-->
<!--}-->
<!--/* #nav {-->
<!--display: flex;-->
<!--align-items: center;-->
<!--top: 0;-->
<!--z-index: 1;-->
<!--}-->

<!--nav {-->
<!--padding: 0px 30px;-->
<!--}-->

<!--nav a {-->
<!--padding-bottom: 10px;-->
<!--font-weight: bold;-->
<!--color: #33404e;-->
<!--text-decoration: none;-->
<!--font-weight: bold;-->
<!--}-->

<!--nav a.active-nav-link {-->
<!--color: #605f6c;-->
<!--}-->

<!--.nav-links {-->
<!--display: flex;-->
<!--flex-wrap: wrap;-->
<!--padding-bottom: 5px;-->
<!--}-->
<!--.links {-->
<!--padding-left: 20px;-->
<!--padding-bottom: 10px;-->
<!--list-style: none;-->
<!--}-->
<!--.links a:hover {-->
<!--color: #706f7c;-->
<!--}-->
<!--.logo {-->
<!--font-size: 20px;-->
<!--color: darkslategray;-->
<!--font-weight: bold;-->
<!--} */-->

<!--</style>-->
</html>